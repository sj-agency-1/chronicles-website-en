---
import PageLayout from '~/layouts/PageLayout.astro';
import GalleryGrid from '~/components/structures/GalleryGrid.astro';
import type { GalleryItemProps } from '~/components/structures/GalleryItem.astro';
import Modal from '~/components/common/Modal.astro';
import Button from '~/components/common/Button.astro';

const metadata = {
  title: 'Gallery',
  ignoreTitleTemplate: true,
};
const breadCrumbLinks = [
  { text: 'Home', href: '/' },
  { text: 'Gallery', href: '/gallery' },
];

const galleryItems: GalleryItemProps[] = [
  { imageUrl: 'https://dummyjson.com/image/300x400?bgColor=grey&text=.', alt: 'Gallery image 1' },
  { imageUrl: 'https://dummyjson.com/image/300x260?bgColor=grey&text=.', alt: 'Gallery image 2' },
  { imageUrl: 'https://dummyjson.com/image/300x260?bgColor=grey&text=.', alt: 'Gallery image 2' },
  { imageUrl: 'https://dummyjson.com/image/300x400?bgColor=grey&text=.', alt: 'Gallery image 1' },
  { imageUrl: 'https://dummyjson.com/image/300x400?bgColor=grey&text=.', alt: 'Gallery image 1' },
  { imageUrl: 'https://dummyjson.com/image/300x260?bgColor=grey&text=.', alt: 'Gallery image 2' },
];
---

<PageLayout
  {breadCrumbLinks}
  {metadata}
  heroItems={[
    {
      title: 'Gallery',
      bgImage: '~/assets/images/pages/gallery.webp',
    },
  ]}
>
  <section class="py-16">
    <GalleryGrid items={galleryItems} />
  </section>

  <Modal id="access-modal" title="No access">
    <p class="text-black">
      This material is for selected scouts only. Please register and request access from the administrator.
    </p>
    <div class="flex flex-col gap-3 mt-2">
      <Button type="link" variant="primary" text="Register" href="#" size="medium" />
      <Button type="link" variant="outlined" text="Request Access" href="#" size="medium" class="flex justify-center" />
    </div>
  </Modal>
</PageLayout>

<script>
  // Auto-open the modal on page load
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('access-modal') as HTMLDialogElement;
    if (modal && typeof modal.showModal === 'function') {
      modal.showModal();

      // Increment modal count for proper scroll lock
      const root = document.documentElement;
      const counterKey = '__chroniclesModalCount';
      const globalScope = window as unknown as Record<string, number>;
      const current = typeof globalScope[counterKey] === 'number' ? globalScope[counterKey] : 0;
      globalScope[counterKey] = current + 1;
      if (globalScope[counterKey] === 1) {
        root.classList.add('modal-open');
      }
    }
  });
</script>
