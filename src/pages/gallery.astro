---
import PageLayout from '~/layouts/PageLayout.astro';
import GalleryBlock from '~/components/blocks/GalleryBlock.astro';
import Modal from '~/components/common/Modal.astro';
import Button from '~/components/common/Button.astro';

const metadata = {
  title: 'Галерея',
  ignoreTitleTemplate: true,
};
const breadCrumbLinks = [
  { text: 'Главная', href: '/' },
  { text: 'Галерея', href: '/gallery' },
];
---

<PageLayout
  {breadCrumbLinks}
  {metadata}
  heroItems={[
    {
      title: 'Фотогалерея',
      bgImage: '~/assets/images/pages/gallery.webp',
    },
  ]}
>
  <section class="py-16">
    <GalleryBlock />
  </section>

  <Modal id="access-modal" title="Нет доступа">
    <p class="text-black">
      Этот материал только для избранных следопытов. Зарегистрируйтесь и запросите доступ у администратора
    </p>
    <div class="flex flex-col gap-3 mt-2">
      <Button type="link" variant="primary" text="Зарегистрироваться" href="#" size="medium" />
      <Button
        type="link"
        variant="outlined"
        text="Запросить доступ"
        href="#"
        size="medium"
        class="flex justify-center"
      />
    </div>
  </Modal>
</PageLayout>

<script>
  // Auto-open the modal on page load
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('access-modal') as HTMLDialogElement;
    if (modal && typeof modal.showModal === 'function') {
      modal.showModal();

      // Increment modal count for proper scroll lock
      const root = document.documentElement;
      const counterKey = '__chroniclesModalCount';
      const globalScope = window as unknown as Record<string, number>;
      const current = typeof globalScope[counterKey] === 'number' ? globalScope[counterKey] : 0;
      globalScope[counterKey] = current + 1;
      if (globalScope[counterKey] === 1) {
        root.classList.add('modal-open');
      }
    }
  });
</script>
